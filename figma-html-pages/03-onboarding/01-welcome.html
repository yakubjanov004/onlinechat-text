<!doctype html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHATFLOW - Onboarding Welcome</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --bg: #f9fafb;
      --white: #ffffff;
      --gray-900: #111827;
      --gray-700: #374151;
      --gray-500: #6b7280;
      --gray-300: #d1d5db;
      --gray-200: #e5e7eb;
      --shadow: 0 10px 24px rgba(17, 24, 39, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 24px;
      background: var(--bg);
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--gray-900);
    }

    .shell {
      width: min(100%, 600px);
    }

    .progress-wrap {
      margin-bottom: 28px;
      display: flex;
      justify-content: center;
    }

    .progress {
      display: inline-flex;
      align-items: center;
      gap: 16px;
    }

    .progress-track {
      display: inline-flex;
      align-items: center;
    }

    .dot {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: var(--gray-300);
      border: 2px solid transparent;
    }

    .dot.active {
      background: var(--primary);
      box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.18);
    }

    .line {
      width: 48px;
      height: 2px;
      background: var(--gray-300);
    }

    .step-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-500);
    }

    .card {
      background: var(--white);
      border: 1px solid var(--gray-200);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 48px;
      text-align: center;
      animation: fade-in-up 0.35s ease-out both;
    }

    .icon {
      width: 64px;
      height: 64px;
      border-radius: 20px;
      margin: 0 auto 24px;
      background: linear-gradient(160deg, #4f46e5, #7c3aed);
      box-shadow: 0 12px 24px rgba(79, 70, 229, 0.28);
      display: grid;
      place-items: center;
    }

    h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      line-height: 1.35;
    }

    .sub {
      margin: 8px auto 24px;
      max-width: 400px;
      font-size: 16px;
      color: var(--gray-500);
      line-height: 1.5;
    }

    .steps {
      margin: 0 0 32px;
      padding: 18px;
      list-style: none;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #eef2f7;
      text-align: left;
    }

    .item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 11px 0;
      border-bottom: 1px solid #eef2f7;
      font-size: 14px;
      color: var(--gray-700);
    }

    .item:last-child {
      border-bottom: 0;
    }

    .left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .bullet {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      flex: 0 0 auto;
    }

    .bullet-1 { background: #4f46e5; }
    .bullet-2 { background: #f59e0b; }
    .bullet-3 { background: #10b981; }
    .bullet-4 { background: #3b82f6; }

    .time {
      font-size: 12px;
      color: var(--gray-500);
      white-space: nowrap;
    }

    .btn {
      width: 100%;
      height: 56px;
      border: 0;
      border-radius: 8px;
      background: var(--primary);
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease, background 0.15s ease;
      position: relative;
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn:focus-visible {
      outline: 3px solid rgba(79, 70, 229, 0.3);
      outline-offset: 2px;
    }

    .btn:disabled {
      opacity: 0.9;
      cursor: not-allowed;
      transform: none;
    }

    .btn.loading {
      color: transparent;
    }

    .btn.loading::after {
      content: "";
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-top-color: #fff;
      position: absolute;
      left: 50%;
      top: 50%;
      margin-left: -9px;
      margin-top: -9px;
      animation: spin 0.8s linear infinite;
    }

    @keyframes fade-in-up {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 700px) {
      .card {
        padding: 28px 20px;
      }

      .line {
        width: 30px;
      }

      h1 {
        font-size: 22px;
      }

      .sub {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <main class="shell">
    <div class="progress-wrap" role="img" aria-label="Onboarding progress: 1 of 4">
      <div class="progress">
        <div class="progress-track" aria-hidden="true">
          <span class="dot active"></span>
          <span class="line"></span>
          <span class="dot"></span>
          <span class="line"></span>
          <span class="dot"></span>
          <span class="line"></span>
          <span class="dot"></span>
        </div>
        <span class="step-label">1/4</span>
      </div>
    </div>

    <section class="card" aria-labelledby="onboarding-title" aria-describedby="onboarding-subtitle">
      <div class="icon" aria-hidden="true">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" focusable="false" aria-hidden="true">
          <path d="M12 2L13.8 7.2L19 9L14.8 11.2L16.2 16.6L12 13.8L7.8 16.6L9.2 11.2L5 9L10.2 7.2L12 2Z" fill="#FFFFFF"></path>
        </svg>
      </div>

      <h1 id="onboarding-title">Xush kelibsiz, <span id="user-name">Ulug'bek</span>!</h1>
      <p class="sub" id="onboarding-subtitle">Keling, 5 daqiqada platformani sozlaymiz</p>

      <ul class="steps" aria-label="Onboarding qadamlar ro'yxati">
        <li class="item">
          <span class="left"><span class="bullet bullet-1"></span>Workspace yaratish</span>
          <span class="time">~1 min</span>
        </li>
        <li class="item">
          <span class="left"><span class="bullet bullet-2"></span>Widgetni sozlash</span>
          <span class="time">~2 min</span>
        </li>
        <li class="item">
          <span class="left"><span class="bullet bullet-3"></span>Widgetni o'rnatish</span>
          <span class="time">~1 min</span>
        </li>
        <li class="item">
          <span class="left"><span class="bullet bullet-4"></span>Test xabar yuborish</span>
          <span class="time">~1 min</span>
        </li>
      </ul>

      <button class="btn" id="start-btn" data-destination="./02-onboarding-setup.html">Boshlash</button>
    </section>
  </main>

  <script>
    var ONBOARDING_STATE_KEY = "chatflow_onboarding_state_v1";

    function sendAnalyticsEvent(name, payload) {
      try {
        if (window.dataLayer && Array.isArray(window.dataLayer)) {
          window.dataLayer.push(Object.assign({ event: name }, payload || {}));
        }
      } catch (_) {
        // ignore analytics failures
      }
    }

    function getSafeNameFromQuery() {
      var params = new URLSearchParams(window.location.search);
      var name = (params.get("name") || "").trim();
      if (!name) {
        return "Ulug'bek";
      }
      return name.slice(0, 32);
    }

    function saveOnboardingState(patch) {
      var current = {};
      try {
        current = JSON.parse(localStorage.getItem(ONBOARDING_STATE_KEY) || "{}");
      } catch (_) {
        current = {};
      }

      var next = Object.assign({}, current, patch || {});
      localStorage.setItem(ONBOARDING_STATE_KEY, JSON.stringify(next));
      return next;
    }

    document.addEventListener("DOMContentLoaded", function () {
      var userName = document.getElementById("user-name");
      var startButton = document.getElementById("start-btn");
      var destination = startButton ? startButton.getAttribute("data-destination") : null;
      var safeName = getSafeNameFromQuery();

      if (userName) {
        userName.textContent = safeName;
      }

      if (startButton && destination) {
        startButton.focus();
        startButton.addEventListener("click", function (event) {
          event.preventDefault();
          if (startButton.disabled) {
            return;
          }

          startButton.disabled = true;
          startButton.classList.add("loading");
          saveOnboardingState({
            status: "in_progress",
            currentStep: 1,
            currentPage: "02-onboarding-setup.html",
            userName: safeName,
            startedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          });
          sendAnalyticsEvent("onboarding_welcome_start", { step: 1, to: destination });

          setTimeout(function () {
            var nextUrl = destination + "?name=" + encodeURIComponent(safeName);
            window.location.href = nextUrl;
          }, 220);
        });
      }
    });
  </script>
</body>
</html>
