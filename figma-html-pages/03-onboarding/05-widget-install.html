<!doctype html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHATFLOW - Widget Install</title>
  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --bg: #f9fafb;
      --white: #ffffff;
      --gray-900: #111827;
      --gray-700: #374151;
      --gray-500: #6b7280;
      --gray-300: #d1d5db;
      --gray-200: #e5e7eb;
      --success: #10b981;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--gray-900);
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      padding: 24px;
    }

    .shell {
      max-width: 920px;
      margin: 0 auto;
    }

    .progress {
      margin: 0 auto 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
    }

    .track {
      display: flex;
      align-items: center;
    }

    .dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: #fff;
      background: var(--gray-300);
    }

    .dot.done,
    .dot.active {
      background: var(--primary);
    }

    .line {
      width: 48px;
      height: 2px;
      background: var(--gray-300);
    }

    .line.done {
      background: var(--primary);
    }

    .step-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-500);
    }

    .card {
      background: var(--white);
      border: 1px solid var(--gray-200);
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(17, 24, 39, 0.08);
      padding: 32px;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 28px;
      font-weight: 600;
    }

    .sub {
      margin: 0 0 24px;
      color: var(--gray-500);
      font-size: 15px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .tab {
      height: 40px;
      border-radius: 8px;
      border: 1px solid var(--gray-200);
      background: #fff;
      padding: 0 14px;
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-700);
    }

    .tab.active {
      border-color: var(--primary);
      background: var(--primary);
      color: #fff;
    }

    .snippet-wrap {
      background: #0f172a;
      border-radius: 12px;
      padding: 16px;
      position: relative;
      margin-bottom: 18px;
    }

    pre {
      margin: 0;
      color: #cbd5e1;
      font-size: 13px;
      line-height: 1.5;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .copy-btn {
      position: absolute;
      right: 12px;
      top: 12px;
      height: 32px;
      padding: 0 12px;
      border-radius: 8px;
      border: 1px solid #475569;
      background: #1e293b;
      color: #e2e8f0;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
    }

    .copy-btn.success {
      background: #064e3b;
      border-color: #10b981;
      color: #d1fae5;
    }

    .instructions {
      margin: 0;
      padding-left: 18px;
      color: var(--gray-700);
      font-size: 14px;
      line-height: 1.7;
    }

    .actions {
      margin-top: 28px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }

    .btn {
      min-width: 160px;
      height: 44px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary {
      border: 1px solid var(--gray-300);
      background: #fff;
      color: var(--gray-700);
    }

    .btn-primary {
      border: none;
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .status {
      margin-top: 14px;
      font-size: 13px;
      color: var(--gray-500);
    }

    .status.ok {
      color: var(--success);
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="progress">
      <div class="track">
        <span class="dot done">✓</span><span class="line done"></span>
        <span class="dot done">✓</span><span class="line done"></span>
        <span class="dot active">3</span><span class="line"></span>
        <span class="dot"></span>
      </div>
      <span class="step-label">3/4</span>
    </div>

    <main class="card">
      <h1>Widgetni saytingizga o'rnating</h1>
      <p class="sub">Platformangizga mos kodni nusxalab, `</body>` dan oldin joylashtiring.</p>

      <div class="tabs">
        <button class="tab active">Website (HTML)</button>
        <button class="tab">WordPress</button>
        <button class="tab">Shopify</button>
        <button class="tab">React</button>
        <button class="tab">Next.js</button>
      </div>

      <div class="snippet-wrap">
        <button class="copy-btn" id="copy-btn">Nusxalash</button>
        <pre id="snippet"></pre>
      </div>

      <ol class="instructions">
        <li>Kodni nusxalang.</li>
        <li>Saytingizning asosiy template faylini oching.</li>
        <li>Snippetni `</body>` yopilish tegi oldidan joylashtiring.</li>
        <li>Deploy qiling va keyingi qadamda tekshiring.</li>
      </ol>

      <p id="status" class="status">Snippet hali nusxalanmadi.</p>

      <div class="actions">
        <button class="btn btn-secondary" id="back-btn">Orqaga</button>
        <button class="btn btn-primary" id="next-btn">Tekshirishga o'tish</button>
      </div>
    </main>
  </div>

  <script>
    var STATE_KEY = "chatflow_onboarding_state_v1";

    function readState() {
      try {
        return JSON.parse(localStorage.getItem(STATE_KEY) || "{}");
      } catch (_) {
        return {};
      }
    }

    function saveState(patch) {
      var current = readState();
      var next = Object.assign({}, current, patch || {}, { updatedAt: new Date().toISOString() });
      localStorage.setItem(STATE_KEY, JSON.stringify(next));
      return next;
    }

    function buildSnippet(state) {
      var workspace = state.workspaceName || "TechUz Support";
      var primaryColor = state.primaryColor || "#4F46E5";
      return [
        "<script>",
        "  window.CHATFLOW_CONFIG = {",
        "    workspace: \"" + workspace.replace(/\"/g, "\\\"") + "\",",
        "    primaryColor: \"" + primaryColor + "\"",
        "  };",
        "</script>",
        "<script src=\"https://cdn.chatflow.uz/widget.js\" async></script>"
      ].join("\n");
    }

    document.addEventListener("DOMContentLoaded", function () {
      var state = readState();
      var snippet = buildSnippet(state);
      var snippetNode = document.getElementById("snippet");
      var copyBtn = document.getElementById("copy-btn");
      var status = document.getElementById("status");
      var backBtn = document.getElementById("back-btn");
      var nextBtn = document.getElementById("next-btn");

      snippetNode.textContent = snippet;

      copyBtn.addEventListener("click", function () {
        navigator.clipboard.writeText(snippet).then(function () {
          copyBtn.classList.add("success");
          copyBtn.textContent = "Nusxalandi";
          status.textContent = "Kodni nusxaladingiz. Endi saytingizga joylashtiring.";
          status.classList.add("ok");
          saveState({ installSnippetCopied: true });
        }).catch(function () {
          status.textContent = "Nusxalash muvaffaqiyatsiz. Qo'lda nusxalang.";
        });
      });

      backBtn.addEventListener("click", function () {
        window.location.href = "./04-widget-customize.html";
      });

      nextBtn.addEventListener("click", function () {
        saveState({
          status: "in_progress",
          currentStep: 4,
          currentPage: "06-widget-verify.html"
        });
        window.location.href = "./06-widget-verify.html";
      });
    });
  </script>
</body>
</html>
