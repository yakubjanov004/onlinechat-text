<!doctype html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHATFLOW - Widget Verify</title>
  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --bg: #f9fafb;
      --white: #ffffff;
      --gray-900: #111827;
      --gray-700: #374151;
      --gray-500: #6b7280;
      --gray-300: #d1d5db;
      --gray-200: #e5e7eb;
      --success: #10b981;
      --warning: #f59e0b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--gray-900);
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      padding: 24px;
    }

    .shell {
      max-width: 860px;
      margin: 0 auto;
    }

    .progress {
      margin: 0 auto 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
    }

    .track {
      display: flex;
      align-items: center;
    }

    .dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: #fff;
      background: var(--gray-300);
    }

    .dot.done,
    .dot.active {
      background: var(--primary);
    }

    .line {
      width: 48px;
      height: 2px;
      background: var(--gray-300);
    }

    .line.done {
      background: var(--primary);
    }

    .step-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--gray-500);
    }

    .card {
      background: var(--white);
      border: 1px solid var(--gray-200);
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(17, 24, 39, 0.08);
      padding: 32px;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 28px;
      font-weight: 600;
    }

    .sub {
      margin: 0 0 24px;
      color: var(--gray-500);
      font-size: 15px;
    }

    .checklist {
      margin: 0;
      padding: 0;
      list-style: none;
      border: 1px solid var(--gray-200);
      border-radius: 10px;
      overflow: hidden;
    }

    .item {
      padding: 14px 16px;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .item:last-child {
      border-bottom: 0;
    }

    .left {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--gray-700);
      font-size: 14px;
    }

    .mark {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-size: 12px;
      font-weight: 700;
      color: #fff;
    }

    .mark.ok {
      background: var(--success);
    }

    .mark.wait {
      background: var(--warning);
    }

    .state {
      font-size: 12px;
      color: var(--gray-500);
    }

    .test {
      margin-top: 18px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
    }

    .test input {
      height: 44px;
      border: 1px solid var(--gray-300);
      border-radius: 8px;
      padding: 0 14px;
      font-size: 14px;
    }

    .btn {
      height: 44px;
      border-radius: 8px;
      border: none;
      padding: 0 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary {
      border: 1px solid var(--gray-300);
      background: #fff;
      color: var(--gray-700);
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .result {
      margin-top: 10px;
      font-size: 13px;
      color: var(--gray-500);
    }

    .actions {
      margin-top: 24px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="progress">
      <div class="track">
        <span class="dot done">✓</span><span class="line done"></span>
        <span class="dot done">✓</span><span class="line done"></span>
        <span class="dot done">✓</span><span class="line done"></span>
        <span class="dot active">4</span>
      </div>
      <span class="step-label">4/4</span>
    </div>

    <main class="card">
      <h1>Tekshirish va test</h1>
      <p class="sub">Widget to'g'ri ishlayotganini tekshiring va onboardingni yakunlang.</p>

      <ul class="checklist">
        <li class="item">
          <span class="left"><span class="mark ok">✓</span>Workspace yaratildi</span>
          <span class="state">Bajarildi</span>
        </li>
        <li class="item">
          <span class="left"><span class="mark ok">✓</span>Widget dizayni sozlandi</span>
          <span class="state">Bajarildi</span>
        </li>
        <li class="item">
          <span class="left"><span class="mark ok">✓</span>Install kodi tayyorlandi</span>
          <span class="state">Bajarildi</span>
        </li>
        <li class="item">
          <span class="left"><span class="mark wait">!</span>Birinchi test xabar yuborish</span>
          <span class="state">Kutilmoqda</span>
        </li>
      </ul>

      <div class="test">
        <input id="test-message" type="text" placeholder="Masalan: Salom, test xabar" />
        <button class="btn btn-primary" id="send-test-btn">Test yuborish</button>
      </div>
      <p class="result" id="result-text">Test xabar yuborilgandan keyin holat yangilanadi.</p>

      <div class="actions">
        <button class="btn btn-secondary" id="back-btn">Orqaga</button>
        <button class="btn btn-primary" id="finish-btn">Dashboardga o'tish</button>
      </div>
    </main>
  </div>

  <script>
    var STATE_KEY = "chatflow_onboarding_state_v1";

    function readState() {
      try {
        return JSON.parse(localStorage.getItem(STATE_KEY) || "{}");
      } catch (_) {
        return {};
      }
    }

    function saveState(patch) {
      var current = readState();
      var next = Object.assign({}, current, patch || {}, { updatedAt: new Date().toISOString() });
      localStorage.setItem(STATE_KEY, JSON.stringify(next));
      return next;
    }

    document.addEventListener("DOMContentLoaded", function () {
      var resultText = document.getElementById("result-text");
      var sendTestBtn = document.getElementById("send-test-btn");
      var finishBtn = document.getElementById("finish-btn");
      var backBtn = document.getElementById("back-btn");
      var testMessage = document.getElementById("test-message");

      sendTestBtn.addEventListener("click", function () {
        var message = (testMessage.value || "").trim();
        if (!message) {
          resultText.textContent = "Test xabar matnini kiriting.";
          return;
        }
        saveState({
          testMessageSent: true,
          testMessageText: message
        });
        resultText.textContent = "Test xabar yuborildi: \"" + message + "\"";
      });

      backBtn.addEventListener("click", function () {
        window.location.href = "./05-widget-install.html";
      });

      finishBtn.addEventListener("click", function () {
        saveState({
          status: "completed",
          currentStep: 4,
          currentPage: "completed",
          completedAt: new Date().toISOString()
        });
        window.location.href = "../04-dashboard/01-dashboard.html";
      });
    });
  </script>
</body>
</html>
